<!doctype html>
<html lang="zh-tw">
  <head>
    <title>使用 ONOS 來控制 P4 Switch // 大叔筆記</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.79.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Chung-Hsiang Cheng" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://john123797.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-79596126-6', 'auto');
	
	ga('send', 'pageview');
}
</script>

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用 ONOS 來控制 P4 Switch"/>
<meta name="twitter:description" content="ONOS 與 P4 如果要在 ONOS 上使用 P4 主要是用以下這些步驟進行開發
 撰寫 P4 程式 編譯後得到 P4Info 文件 撰寫與編譯 Pipeconf 應用程式，此時會將 P4Info、BMv2 JSON、Tofino Binary 等相關文件打包成 oar 檔 撰寫控制應用程式，可以是 Pipeline-agnostic 或是 Pipeline-aware  而其代表的意義如下
  Pipeline-agnostic application: 這類型的應用程式並不會知道即將面對的裝置所用的 Pipeline 長怎麼樣，僅會專心去做要做的事情，舉例來說 ProxyArp 或是 LLDP provider 等等。
  Pipeline-aware application: 這類型的則是針對特定 Pipeline 所設計的，會直接產生出特定的 Flow 以及 Group，並直接安裝到特定的 Table 中。
  ONOS 與 PI 講到 P4 的控制層面一定會想到 PI(protocol independent) 架構 雖然也是有人使用 OpenFlow 來當作控制協議 但其在彈性上並不是很好 故目前大多數人會傾向使用 P4Runtime"/>

    <meta property="og:title" content="使用 ONOS 來控制 P4 Switch" />
<meta property="og:description" content="ONOS 與 P4 如果要在 ONOS 上使用 P4 主要是用以下這些步驟進行開發
 撰寫 P4 程式 編譯後得到 P4Info 文件 撰寫與編譯 Pipeconf 應用程式，此時會將 P4Info、BMv2 JSON、Tofino Binary 等相關文件打包成 oar 檔 撰寫控制應用程式，可以是 Pipeline-agnostic 或是 Pipeline-aware  而其代表的意義如下
  Pipeline-agnostic application: 這類型的應用程式並不會知道即將面對的裝置所用的 Pipeline 長怎麼樣，僅會專心去做要做的事情，舉例來說 ProxyArp 或是 LLDP provider 等等。
  Pipeline-aware application: 這類型的則是針對特定 Pipeline 所設計的，會直接產生出特定的 Flow 以及 Group，並直接安裝到特定的 Table 中。
  ONOS 與 PI 講到 P4 的控制層面一定會想到 PI(protocol independent) 架構 雖然也是有人使用 OpenFlow 來當作控制協議 但其在彈性上並不是很好 故目前大多數人會傾向使用 P4Runtime" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://john123797.github.io/post/p4_onos/" />
<meta property="article:published_time" content="2020-12-14T14:59:13+08:00" />
<meta property="article:modified_time" content="2020-12-14T14:59:13+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://john123797.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="Chung-Hsiang Cheng" /></a>
      <h1>大叔筆記</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">首頁</a> <br>
             
          
          <a class="app-header-menu-item" href="/tags/">標籤</a> <br>
             
          
          <a class="app-header-menu-item" href="/categories/">分類</a> <br>
             
          
          <a class="app-header-menu-item" href="/about_me/">關於我</a> <br>
      </nav>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
      <div class="app-header-social">
        
          <a target="_blank" href="john456797@gmail.com" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link">
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">使用 ONOS 來控制 P4 Switch</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 14, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
              <a class="tag" href="https://john123797.github.io/tags/p4/">P4</a>
              <a class="tag" href="https://john123797.github.io/tags/onos/">ONOS</a>
              <a class="tag" href="https://john123797.github.io/tags/sdn/">SDN</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="onos-與-p4">ONOS 與 P4</h1>
<p><img src="https://i.imgur.com/HPk0acL.png" alt=""></p>
<p>如果要在 ONOS 上使用 P4 主要是用以下這些步驟進行開發</p>
<ol>
<li>撰寫 P4 程式</li>
<li>編譯後得到 P4Info 文件</li>
<li>撰寫與編譯 Pipeconf 應用程式，此時會將 P4Info、BMv2 JSON、Tofino Binary 等相關文件打包成 oar 檔</li>
<li>撰寫控制應用程式，可以是 Pipeline-agnostic 或是 Pipeline-aware</li>
</ol>
<p>而其代表的意義如下</p>
<ul>
<li>
<p>Pipeline-agnostic application: 
這類型的應用程式並不會知道即將面對的裝置所用的 Pipeline 長怎麼樣，僅會專心去做要做的事情，舉例來說 ProxyArp 或是 LLDP provider 等等。</p>
</li>
<li>
<p>Pipeline-aware application: 
這類型的則是針對特定 Pipeline 所設計的，會直接產生出特定的 Flow 以及 Group，並直接安裝到特定的 Table 中。</p>
</li>
</ul>
<h1 id="onos-與-pi">ONOS 與 PI</h1>
<p>講到 P4 的控制層面一定會想到 PI(protocol independent) 架構
雖然也是有人使用 OpenFlow 來當作控制協議
但其在彈性上並不是很好
故目前大多數人會傾向使用 P4Runtime</p>
<p><img src="https://i.imgur.com/GrBL5wX.png" alt=""></p>
<p>上圖是 PI 在 ONOS 架構中的設計
層級可分為三層分別是 Protocol、Driver 與 Core</p>
<p>在 Protocol 層有 P4Runtime，其是透過 gRPC 的方式進行溝通
往上一層是 Driver 層，依照所使用的設備選擇驅動
目前支援 Barefoot Tofino, Mellanox Spectrum 與 BMv2 &hellip; 等
在往上一層是 Core 層，也就是 PI 架構所在的一層
其包含三大模組 PI module、Flow Rule Translation 以及 Pipeconf
若 ONOS 要控制底層 P4 交換器則需撰寫 Pipeconf 應用</p>
<h1 id="透過-onos-控制-bmv2-switch">透過 ONOS 控制 bmv2 switch</h1>
<p><img src="https://i.imgur.com/VAvgwfy.png" alt=""></p>
<p>當寫好一個 P4 檔如果需要控制器去控制的話
ONOS 控制器是一個很好的選擇 其提供 Pipeconf 的方式
讓 ONOS 知道底層 P4 交換器有哪些 pipeline 與 table
ONOS 目前有提供一些 default pipeconf 給使用者選擇
也就是 basic 與 fabric</p>
<p>一個完整的 pipeconf 包含以下元素</p>
<ul>
<li>pipeline config ( bmv2 json, Tofino binary… )</li>
<li>p4info</li>
<li>PipeconfLoader （進入點）</li>
<li>Interpreter ( 可有可無 )</li>
<li>Pipeliner ( 可有可無 )</li>
</ul>
<p>這邊主要會以 PipeconfLoader、Interpreter、Pipeliner 的撰寫來講解</p>
<h3 id="撰寫-pipeconfloader">撰寫 PipeconfLoader</h3>
<p>當 ONOS 啟動 PipeconfLoader 時，會透過 PiPipeconfService 去註冊 Pipeconf
此程式為 Pipeconf 的核心以及程式的進入點
舉例來說如果希望 Pipeconf 擁有 Interpreter 以及 Pipeliner 兩種 Driver Behavior
以及使用 bmv2 json + p4info，可以這樣寫</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">PiPipeconfId id <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PiPipeconfId<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;my-test-pipeconf&#34;</span><span style="color:#f92672">);</span>
URL bmv2ConfigPath <span style="color:#f92672">=</span> TestPipeconfLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/test-pipeline.json&#34;</span><span style="color:#f92672">);</span>
URL p4infoPath <span style="color:#f92672">=</span> TestPipeconfLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/test-pipeline.p4info&#34;</span><span style="color:#f92672">);</span>

pipeconf <span style="color:#f92672">=</span> DefaultPiPipeconf<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">withId</span><span style="color:#f92672">(</span>id<span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">addBehaviour</span><span style="color:#f92672">(</span>Pipeliner<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> TestPipeliner<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">addBehaviour</span><span style="color:#f92672">(</span>PiPipelineInterpreter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> TestInterpreter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">addExtension</span><span style="color:#f92672">(</span>PiPipeconf<span style="color:#f92672">.</span><span style="color:#a6e22e">ExtensionType</span><span style="color:#f92672">.</span><span style="color:#a6e22e">BMV2_JSON</span><span style="color:#f92672">,</span> bmv2ConfigPath<span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">addExtension</span><span style="color:#f92672">(</span>PiPipeconf<span style="color:#f92672">.</span><span style="color:#a6e22e">ExtensionType</span><span style="color:#f92672">.</span><span style="color:#a6e22e">P4_INFO_TEXT</span><span style="color:#f92672">,</span> p4infoPath<span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>

piPipeconfService<span style="color:#f92672">.</span><span style="color:#a6e22e">register</span><span style="color:#f92672">(</span>pipeconf<span style="color:#f92672">);</span>
</code></pre></div><p>上述的程式可以放在 activate function 中
ONOS 安裝這個 App（oar）時就會將 Pipeconf 載入</p>
<h3 id="撰寫-interpreter">撰寫 Interpreter</h3>
<p>Interpreter 主要是處理 ONOS API 轉換至 PI API 的工作</p>
<ul>
<li>mapCriterionType: 將 ONOS Criterion 轉換成 PI match 欄位</li>
<li>mapPiMatchFieldId: 將 PI match 欄位轉換成普通的 Criterion</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Optional<span style="color:#f92672">&lt;</span>PiMatchFieldId<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">mapCriterionType</span><span style="color:#f92672">(</span>Criterion<span style="color:#f92672">.</span><span style="color:#a6e22e">Type</span> type<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>CRITERION_MAP<span style="color:#f92672">.</span><span style="color:#a6e22e">containsKey</span><span style="color:#f92672">(</span>type<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>PiMatchFieldId<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>CRITERION_MAP<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>type<span style="color:#f92672">)));</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>mapFlowRuleTableId: 將數字 Id 轉換成像是 P4 一樣使用字串的 Id</li>
<li>mapPiTableId: 將字串 Id 轉換回數字 Id</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Optional<span style="color:#f92672">&lt;</span>PiTableId<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">mapFlowRuleTableId</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> flowRuleTableId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">empty</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>mapTreatment: 將 ONOS 的 TrafficTreatment 加上 TableId 轉換成 PiAction，這主要是要解決多個 Action 對到單一個 Action 的問題</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> PiAction <span style="color:#a6e22e">mapTreatment</span><span style="color:#f92672">(</span>TrafficTreatment treatment<span style="color:#f92672">,</span> PiTableId piTableId<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> PiInterpreterException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> PiInterpreterException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Treatment mapping not supported&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>mapOutboundPacket: 將 ONOS PacketOut 轉換成 PI 格式，即 metadata + paylad</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Collection<span style="color:#f92672">&lt;</span>PiPacketOperation<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">mapOutboundPacket</span><span style="color:#f92672">(</span>OutboundPacket packet<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> PiInterpreterException <span style="color:#f92672">{</span>
    TrafficTreatment treatment <span style="color:#f92672">=</span> packet<span style="color:#f92672">.</span><span style="color:#a6e22e">treatment</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">// Packet-out in main.p4 supports only setting the output port,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// i.e. we only understand OUTPUT instructions.
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>OutputInstruction<span style="color:#f92672">&gt;</span> outInstructions <span style="color:#f92672">=</span> treatment
            <span style="color:#f92672">.</span><span style="color:#a6e22e">allInstructions</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>i <span style="color:#f92672">-&gt;</span> i<span style="color:#f92672">.</span><span style="color:#a6e22e">type</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>OUTPUT<span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>i <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">(</span>OutputInstruction<span style="color:#f92672">)</span> i<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>toList<span style="color:#f92672">());</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>treatment<span style="color:#f92672">.</span><span style="color:#a6e22e">allInstructions</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> outInstructions<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// There are other instructions that are not of type OUTPUT.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> PiInterpreterException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Treatment not supported: &#34;</span> <span style="color:#f92672">+</span> treatment<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    ImmutableList<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span><span style="color:#f92672">&lt;</span>PiPacketOperation<span style="color:#f92672">&gt;</span> builder <span style="color:#f92672">=</span> ImmutableList<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>OutputInstruction outInst <span style="color:#f92672">:</span> outInstructions<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>outInst<span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">().</span><span style="color:#a6e22e">isLogical</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>outInst<span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>FLOOD<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> PiInterpreterException<span style="color:#f92672">(</span>format<span style="color:#f92672">(</span>
                    <span style="color:#e6db74">&#34;Packet-out on logical port &#39;%s&#39; not supported&#34;</span><span style="color:#f92672">,</span>
                    outInst<span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">()));</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>outInst<span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>FLOOD<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// To emulate flooding, we create a packet-out operation for
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// each switch port.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">final</span> DeviceService deviceService <span style="color:#f92672">=</span> handler<span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>DeviceService<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Port port <span style="color:#f92672">:</span> deviceService<span style="color:#f92672">.</span><span style="color:#a6e22e">getPorts</span><span style="color:#f92672">(</span>packet<span style="color:#f92672">.</span><span style="color:#a6e22e">sendThrough</span><span style="color:#f92672">()))</span> <span style="color:#f92672">{</span>
                builder<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>buildPacketOut<span style="color:#f92672">(</span>packet<span style="color:#f92672">.</span><span style="color:#a6e22e">data</span><span style="color:#f92672">(),</span> port<span style="color:#f92672">.</span><span style="color:#a6e22e">number</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toLong</span><span style="color:#f92672">()));</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// Create only one packet-out for the given OUTPUT instruction.
</span><span style="color:#75715e"></span>            builder<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>buildPacketOut<span style="color:#f92672">(</span>packet<span style="color:#f92672">.</span><span style="color:#a6e22e">data</span><span style="color:#f92672">(),</span> outInst<span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toLong</span><span style="color:#f92672">()));</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> builder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>mapInboundPacket: 將 ONOS PacketIn 轉換成 PI 格式</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> InboundPacket <span style="color:#a6e22e">mapInboundPacket</span><span style="color:#f92672">(</span>PiPacketOperation packetIn<span style="color:#f92672">,</span> DeviceId deviceId<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> PiInterpreterException <span style="color:#f92672">{</span>

    <span style="color:#75715e">// Find the ingress_port metadata.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> String inportMetadataName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ingress_port&#34;</span><span style="color:#f92672">;</span>
    Optional<span style="color:#f92672">&lt;</span>PiPacketMetadata<span style="color:#f92672">&gt;</span> inportMetadata <span style="color:#f92672">=</span> packetIn<span style="color:#f92672">.</span><span style="color:#a6e22e">metadatas</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>meta <span style="color:#f92672">-&gt;</span> meta<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">().</span><span style="color:#a6e22e">id</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>inportMetadataName<span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">findFirst</span><span style="color:#f92672">();</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>inportMetadata<span style="color:#f92672">.</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> PiInterpreterException<span style="color:#f92672">(</span>format<span style="color:#f92672">(</span>
                <span style="color:#e6db74">&#34;Missing metadata &#39;%s&#39; in packet-in received from &#39;%s&#39;: %s&#34;</span><span style="color:#f92672">,</span>
                inportMetadataName<span style="color:#f92672">,</span> deviceId<span style="color:#f92672">,</span> packetIn<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Build ONOS InboundPacket instance with the given ingress port.
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// 1. Parse packet-in object into Ethernet packet instance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> payloadBytes <span style="color:#f92672">=</span> packetIn<span style="color:#f92672">.</span><span style="color:#a6e22e">data</span><span style="color:#f92672">().</span><span style="color:#a6e22e">asArray</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">final</span> ByteBuffer rawData <span style="color:#f92672">=</span> ByteBuffer<span style="color:#f92672">.</span><span style="color:#a6e22e">wrap</span><span style="color:#f92672">(</span>payloadBytes<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">final</span> Ethernet ethPkt<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        ethPkt <span style="color:#f92672">=</span> Ethernet<span style="color:#f92672">.</span><span style="color:#a6e22e">deserializer</span><span style="color:#f92672">().</span><span style="color:#a6e22e">deserialize</span><span style="color:#f92672">(</span>
                payloadBytes<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> packetIn<span style="color:#f92672">.</span><span style="color:#a6e22e">data</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>DeserializationException dex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> PiInterpreterException<span style="color:#f92672">(</span>dex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// 2. Get ingress port
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> ImmutableByteSequence portBytes <span style="color:#f92672">=</span> inportMetadata<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">().</span><span style="color:#a6e22e">value</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">short</span> portNum <span style="color:#f92672">=</span> portBytes<span style="color:#f92672">.</span><span style="color:#a6e22e">asReadOnlyBuffer</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getShort</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">final</span> ConnectPoint receivedFrom <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConnectPoint<span style="color:#f92672">(</span>
            deviceId<span style="color:#f92672">,</span> PortNumber<span style="color:#f92672">.</span><span style="color:#a6e22e">portNumber</span><span style="color:#f92672">(</span>portNum<span style="color:#f92672">));</span>

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DefaultInboundPacket<span style="color:#f92672">(</span>receivedFrom<span style="color:#f92672">,</span> ethPkt<span style="color:#f92672">,</span> rawData<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="撰寫-pipeliner">撰寫 Pipeliner</h3>
<p>Pipeliner 是專門將 FlowObjective 轉換成 Flow + Group 的一個組件</p>
<ul>
<li>FilteringObjective：用來表示允許或是擋掉封包進入 Pipeliner 的規則</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>FilteringObjective obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    obj<span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">().</span><span style="color:#a6e22e">ifPresent</span><span style="color:#f92672">(</span>c <span style="color:#f92672">-&gt;</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">onError</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> ObjectiveError<span style="color:#f92672">.</span><span style="color:#a6e22e">UNSUPPORTED</span><span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>ForwardingObjective：用來描述封包在 Pipeliner 中需要如何去處理</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>ForwardingObjective obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">treatment</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        obj<span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">().</span><span style="color:#a6e22e">ifPresent</span><span style="color:#f92672">(</span>c <span style="color:#f92672">-&gt;</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">onError</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> ObjectiveError<span style="color:#f92672">.</span><span style="color:#a6e22e">UNSUPPORTED</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Whether this objective specifies an OUTPUT:CONTROLLER instruction.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">boolean</span> hasCloneToCpuAction <span style="color:#f92672">=</span> obj<span style="color:#f92672">.</span><span style="color:#a6e22e">treatment</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">allInstructions</span><span style="color:#f92672">().</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>i <span style="color:#f92672">-&gt;</span> i<span style="color:#f92672">.</span><span style="color:#a6e22e">type</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>OUTPUT<span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>i <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">(</span>Instructions<span style="color:#f92672">.</span><span style="color:#a6e22e">OutputInstruction</span><span style="color:#f92672">)</span> i<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">anyMatch</span><span style="color:#f92672">(</span>i <span style="color:#f92672">-&gt;</span> i<span style="color:#f92672">.</span><span style="color:#a6e22e">port</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>PortNumber<span style="color:#f92672">.</span><span style="color:#a6e22e">CONTROLLER</span><span style="color:#f92672">));</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>hasCloneToCpuAction<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// We support only objectives for clone to CPU behaviours (e.g. for
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// host and link discovery)
</span><span style="color:#75715e"></span>        obj<span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">().</span><span style="color:#a6e22e">ifPresent</span><span style="color:#f92672">(</span>c <span style="color:#f92672">-&gt;</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">onError</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> ObjectiveError<span style="color:#f92672">.</span><span style="color:#a6e22e">UNSUPPORTED</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Create an equivalent FlowRule with same selector and clone_to_cpu action.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">final</span> PiAction cloneToCpuAction <span style="color:#f92672">=</span> PiAction<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">withId</span><span style="color:#f92672">(</span>PiActionId<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>CLONE_TO_CPU<span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>

    <span style="color:#66d9ef">final</span> FlowRule<span style="color:#f92672">.</span><span style="color:#a6e22e">Builder</span> ruleBuilder <span style="color:#f92672">=</span> DefaultFlowRule<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">forTable</span><span style="color:#f92672">(</span>PiTableId<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>ACL_TABLE<span style="color:#f92672">))</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">forDevice</span><span style="color:#f92672">(</span>deviceId<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">withSelector</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">selector</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">fromApp</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">appId</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">withPriority</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">priority</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">withTreatment</span><span style="color:#f92672">(</span>DefaultTrafficTreatment<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                                   <span style="color:#f92672">.</span><span style="color:#a6e22e">piTableAction</span><span style="color:#f92672">(</span>cloneToCpuAction<span style="color:#f92672">).</span><span style="color:#a6e22e">build</span><span style="color:#f92672">());</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">permanent</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
       ruleBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">makePermanent</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
       ruleBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">makeTemporary</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">timeout</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">final</span> GroupDescription cloneGroup <span style="color:#f92672">=</span> Utils<span style="color:#f92672">.</span><span style="color:#a6e22e">buildCloneGroup</span><span style="color:#f92672">(</span>
            obj<span style="color:#f92672">.</span><span style="color:#a6e22e">appId</span><span style="color:#f92672">(),</span>
            deviceId<span style="color:#f92672">,</span>
            CPU_CLONE_SESSION_ID<span style="color:#f92672">,</span>
            <span style="color:#75715e">// Ports where to clone the packet.
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// Just controller in this case.
</span><span style="color:#75715e"></span>            Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">singleton</span><span style="color:#f92672">(</span>PortNumber<span style="color:#f92672">.</span><span style="color:#a6e22e">CONTROLLER</span><span style="color:#f92672">));</span>

    <span style="color:#66d9ef">switch</span> <span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">op</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> ADD<span style="color:#f92672">:</span>
            flowRuleService<span style="color:#f92672">.</span><span style="color:#a6e22e">applyFlowRules</span><span style="color:#f92672">(</span>ruleBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">());</span>
            groupService<span style="color:#f92672">.</span><span style="color:#a6e22e">addGroup</span><span style="color:#f92672">(</span>cloneGroup<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">case</span> REMOVE<span style="color:#f92672">:</span>
            flowRuleService<span style="color:#f92672">.</span><span style="color:#a6e22e">removeFlowRules</span><span style="color:#f92672">(</span>ruleBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">());</span>
            groupService<span style="color:#f92672">.</span><span style="color:#a6e22e">removeGroup</span><span style="color:#f92672">(</span>deviceId<span style="color:#f92672">,</span> cloneGroup<span style="color:#f92672">.</span><span style="color:#a6e22e">appCookie</span><span style="color:#f92672">(),</span> obj<span style="color:#f92672">.</span><span style="color:#a6e22e">appId</span><span style="color:#f92672">());</span>
            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
            log<span style="color:#f92672">.</span><span style="color:#a6e22e">warn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Unknown operation {}&#34;</span><span style="color:#f92672">,</span> obj<span style="color:#f92672">.</span><span style="color:#a6e22e">op</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    obj<span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">().</span><span style="color:#a6e22e">ifPresent</span><span style="color:#f92672">(</span>c <span style="color:#f92672">-&gt;</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">onSuccess</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>NextObjective：用來描述 Egress table 裡面需要放置什麼樣的東西</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">next</span><span style="color:#f92672">(</span>NextObjective obj<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    obj<span style="color:#f92672">.</span><span style="color:#a6e22e">context</span><span style="color:#f92672">().</span><span style="color:#a6e22e">ifPresent</span><span style="color:#f92672">(</span>c <span style="color:#f92672">-&gt;</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">onError</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> ObjectiveError<span style="color:#f92672">.</span><span style="color:#a6e22e">UNSUPPORTED</span><span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getNextMappings</span><span style="color:#f92672">(</span>NextGroup nextGroup<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// We do not use nextObjectives or groups.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">emptyList</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h1 id="參考文獻">參考文獻</h1>
<ul>
<li><a href="https://p4tw.org/">P4 台灣社群</a></li>
<li><a href="https://wiki.onosproject.org/pages/viewpage.action?pageId=16122675">ONOS+P4 Tutorial for Beginners</a></li>
</ul>

    </div>
    <div class="post-footer">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "uncle-notes" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </article>

    </main>
  </body>
</html>
